---
sidebar_position: 3
description: 了解求通项问题的做题技巧．
---

# 通项问题

## 求和问题

### 等差乘等比数列的前缀和

> 已知等差数列 $a$，公差 $d$，等比数列 $b$，公比 $q$，求 $\{a_n \cdot b_n\}$ 的前缀和 $S_n$．

这是一类套路题，属于必会类型，只需要按照下面的操作按部就班计算即可．

首先我们钦定 $q \ne 1$．$q = 1$ 的情形其实就是一个纯等差数列求和．

$$
\begin{matrix}
S_n  & = & a_1 \cdot b_1 & + & a_2 \cdot b_2 & + & a_3 \cdot b_3 & + & \cdots & + & a_n \cdot b_n       &   & \\
qS_n & = &               &   & a_2 \cdot b_1 & + & a_3 \cdot b_2 & + & \cdots & + & a_n \cdot b_{n - 1} & + & a_{n + 1} \cdot b_n
\end{matrix}
$$

上减下：

$$
(1 - q)S_n = a_1 \cdot b_1 - a_{n + 1} \cdot b_n + d(a_2 + a_3 + \cdots + a_n)
$$

$a_2 + a_3 + \cdots + a_n$ 可以使用等比数列求和公式：

$$
a_2 + a_3 + \cdots + a_n = a_1q \cdot \dfrac{q^{n - 1} - 1}{q - 1}
$$

这里有一个小细节：$n = 1$ 左侧数列为空了，所以要验证一下右边 $n = 1$ 的结果是否为 $0$，验证发现是，因此可以．其实等比数列求和公式计算空数列的时候答案一定是正确的 $0$（等差数列求和公式则不一定），所以这步验证通常不要求写出．

因此最后的式子就是

$$
(1 - q)S_n = a_1 \cdot b_1 - a_{n + 1} \cdot b_n + a_1dq \cdot \dfrac{q^{n - 1} - 1}{q - 1}
$$

此时 $S_n$ 已经可求．上式可以选择性记忆，推荐按照错位相减理解性记忆．

最后，等差乘等比数列一般表现为 **一个一次函数乘上一个幂函数**，如 $\left\{(3n+1)2^n\right\}$，$\left\{\dfrac{n + 1}{2^n}\right\}$，求它们的前缀和要学会识别出是这种类型的问题．

最后的最后，上面的式子 $S_n$ 还有个系数，别把等号右边的结果直接当成 $S_n$ 了．

### 高斯求和

其实这种问题跟数列没什么关系（只是运用了一下高斯求等差数列和的思想），很简单，直接上题．

:::info 例题 1.2

已知 $f(x) = \dfrac{4^x}{4^x + 2}$，求 $f(0) + f\left(\dfrac 1 {10}\right) + f\left(\dfrac 2 {10} \right) + \cdots + f\left(\dfrac 9 {10}\right) + f(1)$ 的值．

:::

:::tip 例题 1.2 解答

猜测：$f(x) + f(1 - x)$ 也是一个定值．

证明：

$$
\begin{aligned}
f(x) + f(1 - x) &= \dfrac{4^x}{4^x + 2} + \dfrac{4^{1 - x}}{4^{1 - x} + 2} \\[1em]
& = \dfrac{4^x}{4^x + 2} + \dfrac{4}{2 \cdot 4^x + 4} \\[1em]
& = \dfrac{4^x}{4^x + 2} + \dfrac{2}{4^x + 2} \\[1em]
& = 1
\end{aligned}
$$

确实是定值．

将所求的 $x$ 与 $1 - x$ 配对，可以发现共有 $5$ 对，中间剩余一个 $\dfrac 1 2$．

我们有 $f\left(\dfrac 1 2\right) + f\left(\dfrac 1 2\right) = 1$，因此 $f\left(\dfrac 1 2 \right) = \dfrac 1 2$．

所以答案是 $5 + \dfrac 1 2 = \dfrac{11}2$．

:::

还有一种题，如 $f(1) + f(2) + \cdots + f(100) + f\left(\dfrac 1 2\right) + f\left(\dfrac 1 3\right) + f\left(\dfrac 1 {100}\right)$ 的值，这种就是 $f(x)$ 和 $f\left(\dfrac 1 x\right)$ 配对了（有一个 $f(1)$ 需要单算）．

下面说一下这种函数的常见形态和构造方式：

- $f(x) + f\left(\dfrac 1 x\right) = \mathrm{const.}$：$f(x) = \dfrac{1}{x^n + 1}$ 和 $f(x) = \dfrac{x^n}{x^n + 1}$ 两类函数均满足此要求，其中 $n$ 取任意实数．
- $f(x) + f(a - x) = b = \mathrm{const.}$：等价于 $f$ 关于 $\left(\dfrac a 2, \dfrac b 2\right)$ 中心对称，取一个奇函数做平移即可．

### 裂项求和

裂项指的是对一类分式：**分母能因式分解为两不等项之积** 的分式——$\dfrac{a}{pq}$ 的处理策略（$p \ne q$）：

$$
\dfrac{a}{pq} = \dfrac a {q - p} \left(\dfrac 1 p - \dfrac 1 q \right)
$$

**括号外分式的形式** $\dfrac{分子}{分母差}$ 应当 **熟练掌握**，且括号外分母相减的顺序与括号内恰好 **相反**．

裂项相消是经典小学奥数题，但笔者其实并不喜欢用「相消」理解这类型题——因为「相消」容易消乱，而且它存在一些逻辑缺陷（后面会谈）．这里会采用另一种没有逻辑缺陷的方式——「滑动窗口」讲解．

对于一个数列 $a$，记 $[l, r]$ 为 $a$ 的区间和 $\sum_{i = l}^r a_i$，则 $\forall n, k \in \N ^ \ast$，我们有

$$
[1, n] - [k + 1, n + k] = [1, k] - [n + 1, n + k]
$$

这个式子很好证：$n$ 与 $k$ 地位完全相同，可以互相交换，而这个等式正是 $n$ 与 $k$ 互相交换的结果．

我们可以具象一下这个式子——一个数列 $a$ 上，有一个长度为 $n$ 的 **窗口**：

- **窗口可以展示 $a$ 的一个长度为 $n$ 的区间**，除了窗口展示的部分，其它部分均不可见．
- **窗口可以滑动**．窗口左端放在 $a_1$ 时，窗口展示的部分就是 $a_1, a_2, \ldots, a_n$；放在 $a_5$ 时，窗口展示的部分就是 $a_5, a_6, \ldots, a_{n + 4}$．
- 下称观测者 **通过窗口看到的区间和**，为 **窗口的区间和**．

那么，窗口在最左端时，窗口区间和就是 $[1, n]$；现在将窗口向右滑动 $k$ 个距离，此时窗口区间和就是 $[k + 1, n + k]$．两次窗口展示的区间和之差即 $[1, n] - [k + 1, n + k]$，我们称这个差值为「滑动窗口差」．

那么一开始的等式的含义就是：对于上述滑动窗口的过程，将 **窗口的长度** 与 **窗口的滑动距离** 交换，「滑动窗口差」不变．下面我们称这个结论为「滑动窗口定理」．

举例：现有一个数列 $a$，$(a_1 + a_2 + a_3) - (a_3 + a_4 + a_5)$ 就是窗口长度 $3$，滑动距离 $2$ 的「滑动窗口差」．根据「滑动窗口定理」，它的结果就等于窗口长度 $2$，滑动距离 $3$ 对应的「滑动窗口差」：$(a_1 + a_2) - (a_4 + a_5)$．

接下来我们会看到「滑动窗口定理」是如何在裂项中发挥作用的．

:::info 例题 1.3.1

求 $a_n = \dfrac 1 {n(n + 2)}$ 的前缀和．

:::

:::tip 例题 1.3.1 解答

对每个 $a_n$ 裂项：

$$
S_n = \dfrac 1 2\left(1 - \dfrac 1 3 + \dfrac 1 2 - \dfrac 1 4 + \cdots + \dfrac 1 n - \dfrac 1 {n + 2}\right)
$$

我们来看括号里的式子如何进一步化简：

$$
\begin{aligned}
& \phantom = 1 - \dfrac 1 3 + \dfrac 1 2 - \dfrac 1 4 + \cdots + \dfrac 1 n - \dfrac 1 {n + 2} \\
& = \left(1 + \dfrac 1 2 + \cdots + \dfrac 1 n\right) - \left(\dfrac 1 3 + \dfrac 1 4 + \cdots + \dfrac 1 {n + 2}\right) \\
& = 1 + \dfrac 1 2 - \left(\dfrac 1 {n + 1} + \dfrac 1 {n + 2} \right) \\
& = \cdots（可以继续化简，这里省略）
\end{aligned}
$$

:::

这里第一个等号我们 **将正与负分类开**，这是比混在一起相消更加清晰的，推荐读者使用．

而第二个等号就是「滑动窗口定理」的使用：

$$
\left(1 + \dfrac 1 2 + \cdots + \dfrac 1 n\right) - \left(\dfrac 1 3 + \dfrac 1 4 + \cdots + \dfrac 1 {n + 2}\right)
$$

可以理解为数列 $b_i = \left\{\dfrac 1 i \right\}$ 的窗口长度为 $n$，滑动距离为 $2$ 的「滑动窗口差」．根据「滑动窗口定理」，它的结果就是长度为 $2$，滑动距离为 $n$ 的「滑动窗口差」：

$$
\left(1 + \dfrac 1 2\right) - \left(\dfrac 1 {n + 1} + \dfrac 1 {n + 2}\right)
$$

:::note 用相消理解的缺陷

来看这一步：

$$
\begin{aligned}
& \phantom = \left(1 + \dfrac 1 2 + \cdots + \dfrac 1 n\right) - \left(\dfrac 1 3 + \dfrac 1 4 + \cdots + \dfrac 1 {n + 2}\right) \\
& = 1 + \dfrac 1 2 - \left(\dfrac 1 {n + 1} + \dfrac 1 {n + 2} \right)
\end{aligned}
$$

这是一个长度为 $n$，滑动距离为 $2$ 的「滑动窗口定理」的使用，但在实际教学中，一般会称这一步是「相消」的体现．

在相消法中的解释是：两个括号内重叠的部分 $\dfrac 1 3 + \dfrac 1 4 + \cdots + \dfrac 1 n$ 可以消去，只剩下了 $1 + \dfrac 1 2 - \left(\dfrac 1 {n + 1} + \dfrac 1 {n + 2} \right)$．

事实上这个解释在 $n > 2$ 时都没有任何问题；$n = 2$ 时，上面的重叠部分不存在，剩下的结构正好是 $1 + \dfrac 1 2 - \left(\dfrac 1 {n + 1} + \dfrac 1 {n + 2} \right)$，所以也没问题．但 $n$ 更小的情况呢？

$n = 1$ 时的结果是

$$
\begin{aligned}
2S_1 & =  1 - \dfrac 1 3 \\
& = 1 + \dfrac 1 2 - \left(\dfrac 1 2 + \dfrac 1 3 \right)
\end{aligned}
$$

发现了吗？相消已经不能解释第二个等号是怎么来的了，因为此时已经不是「消」而是「补」了．

这里滑动距离为 $2$，所以只有 $S_1$ 出问题．可以试想一下，如果滑动距离为 $k = 100$，那么相消也只能解释 $S_{100}$ 及更往后的前缀和，而对 $S_{99}$ 以前的前缀和也存在解释的不充分．

这就是相消法的逻辑疏漏所在了，而「滑动窗口」中窗口长度与滑动距离都是可以在正整数集任意选取的，因此「滑动窗口」可以没有纰漏地解释这个等式．

:::

:::info 例题 1.3.2

已知 $a$ 的通项公式为 $a_n = 3 \cdot 4 ^{n - 1}$，$a$ 的前缀和为 $S_n$，$b_n = \dfrac{a_{n + 1}}{(a_{n + 1} - 3)S_{n + 1}}$，求 $b$ 的前缀和 $T_n$．

:::

:::tip 例题 1.3.2 解答

$a$ 是首项 $a_1 = 3$，公比 $q = 4$ 的等比数列，因此

$$
S_n = a_1 \cdot \dfrac{q^n - 1}{q - 1} = 4^n - 1
$$

因此

$$
b_n = \dfrac{3 \cdot 4^n}{(3 \cdot 4^n - 3)(4^{n + 1} - 1)}
$$

**这个形式已经可以裂项了，因为分母写成了两项之积**．部分读者可能还有对裂项只能解决 $\dfrac 1 {(2n - 1)(2n + 1)}$ 这种式子的刻板印象，是时候打破了！

但是先别急着裂项，这个形式裂项之后后面做不下去．这里分子分母可以同时约去 $3$：

$$
b_n = \dfrac{4^n}{(4^n - 1)(4^{n + 1} - 1)}
$$

现在就可以开始裂项了，记住提出的系数是 $\dfrac{分子}{分母差}$，先计算一下：

$$
\dfrac{4^n}{(4^{n + 1} - 1) - (4^n - 1)} = \dfrac{4^n}{4^{n + 1} - 4^n} = \dfrac{1}{4 - 3} = \dfrac 1 3
$$

因此 $b_n$ 裂项的结果是：

$$
b_n = \dfrac 1 3 \left(\dfrac 1 {4^n - 1} - \dfrac 1 {4^{n + 1} - 1}\right)
$$

也可以写成

$$
3b_n = \dfrac 1 {4^n - 1} - \dfrac 1 {4^{n + 1} - 1}
$$

现在可以开始求 $T_n$ 了，这里求和就按照正负分类来写：

$$
3T_n = \left(\dfrac 1 {4 - 1} + \dfrac 1 {4^2 - 1} + \cdots + \dfrac 1 {4^n - 1}\right) - \left(\dfrac 1 {4^2 - 1} + \dfrac 1 {4^3 - 1} + \cdots + \dfrac 1 {4^{n + 1} - 1}\right)
$$

「滑动窗口定理」：

$$
3T_n = \dfrac 1 3 - \dfrac 1 {4^{n + 1} - 1}
$$

即

$$
T_n = \dfrac 1 9 - \dfrac 1 {3 \cdot 4^{n + 1} - 3}
$$

化简到这里就可以了，不用再通分了．

:::

分母写成两项之积的分式一定可以裂项，但并不是所有这样的分式裂项之后都适合求和．适合求和的裂项应当满足裂项的结果正负分类后，能构成一个数列的「滑动窗口差」的形式．那么这就需要 **裂项形成的两个分母能表示为一个数列的某两项**，即

$$
a_n = \dfrac{\cdots}{b_nb_{n + k}}
$$

举个例子．上面例题中的数列

$$
\dfrac{3 \cdot 4^n}{(3 \cdot 4^n - 3)(4^{n + 1} - 1)}
$$

$3 \cdot 4^n - 3$ 与 $4^{n + 1} - 1$ 很难写成同一个数列的两项．而

$$
\dfrac{4^n}{(4^n - 1)(4^{n + 1} - 1)}
$$

$4^n - 1$ 与 $4^{n + 1} - 1$ 显然可以写成数列 $\{4^n - 1\}$ 的第 $n$ 项与第 $n + 1$ 项．

因此，后者才是一个比较合适的裂项．
